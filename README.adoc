# nix-setup

## Getting started

Run the setup script:

```bash
sudo ./setup.sh
```

which will perform the following actions for you:

1. Install link:https://nixos.org/nix/download.html[nix]
1. if on a Mac install link:https://github.com/LnL7/nix-darwin#install[nix-darwin]
1. install link:https://rycee.gitlab.io/home-manager/index.html#sec-install-standalone[home-manager]
1. clone this repo to `~/.nixpkgs`
1. back-up `/etc/shells`
1. moves default ZSH zprofile and zshrc (they still get loaded!)

Now run `darwin-rebuild switch` to install all the dependencies.

### Setup bash completions

For bash completions to work properly the system must use the nix supplied version of bash as the MacOS version is ancient.

See https://discourse.nixos.org/t/using-nix-to-install-login-shell-on-non-nixos-platform/2807/3

```
chsh -s /run/current-system/sw/bin/bash
```

To not enter password on every darwin-rebuild switch with nix-darwin, you can create /etc/sudoers.d/nix-darwin file with this content:
```
<home-user> ALL=(ALL:ALL) NOPASSWD: /run/current-system/sw/bin/darwin-rebuild (where home-user is name of home directory)
```

Before upgrading to Catalina:

* https://gist.github.com/chrisandreae/e61e06f08ec0a650a0b3b41788d41724
* https://github.com/NixOS/nix/issues/2925

## References:

* https://github.com/nmattia/homies/blob/master/git/default.nix
* https://github.com/rummik/nixos-config/blob/master/config/nodejs.nix
* https://discourse.nixos.org/t/bootstrapping-new-system/3455/9
* https://nixos.org/nix/manual/#ssec-builtins
* https://rycee.gitlab.io/home-manager/options.html
* https://medium.com/@ejpcmac/about-using-nix-in-my-development-workflow-12422a1f2f4c
* https://github.com/direnv/direnv#setup
* https://wiki.nikitavoloboev.xyz/package-managers/nix/nix-darwin
* https://www.softinio.com/post/moving-from-homebrew-to-nix-package-manager/
* http://chriswarbo.net/git/nix-helpers/git/branches/master/index.html
* http://chriswarbo.net/projects/nixos/useful_hacks.html
* https://github.com/danieldk/nix-home/tree/master/cfg
* https://github.com/jwiegley/nix-config/blob/master/overlays/30-apps.nix
* https://github.com/Jomik/dotfiles/tree/master/.config/nixpkgs
* https://rycee.net/posts/2017-07-02-manage-your-home-with-nix.html

## Todo

* direnv setup for a project https://github.com/direnv/direnv/wiki/Nix#shell-function-to-quickly-setup-nix--direnv-in-a-new-project

